# Word-Office-Add-ins

Локальная надстройка для Microsoft Word: из формального описания (пункты/факты/артефакты) генерирует официально‑деловой текст разделов отчёта (Finding, Executive Summary, Методология). Работает целиком локально через Ollama и модель `deepseek-r1:14b` (можно заменить).

---

## Возможности
- Перевод формальных заметок в выверенный текст отчёта (RU/EN).
- Шаблоны: **Finding** / **Executive Summary** / **Методология** + выбор секций.
- Управление краткостью и (опционально) указание критичности.
- Загрузка текста из выделения в Word и вставка результата обратно.
- Работа с локальной LLM через `Ollama /api/chat`; скрытие блоков `<think>…</think>`.

---

## Что нужно
- **Microsoft Word** (Desktop, Windows/macOS).
- **Node.js 18+** (для локального HTTPS‑сервера/утилит).
- **Ollama** и модель:

```bash
# пример (macOS)
brew install ollama
ollama pull deepseek-r1:14b   # либо любую совместимую русскоязычную
```

- **HTTPS** для панели (Word блокирует смешанный контент):
  - либо запустите dev‑сервер на `https://localhost:3000`,
  - либо проксируйте Ollama на `https://127.0.0.1:11435`.

Рекомендуемые переменные окружения для CORS Ollama (macOS):

```bash
launchctl setenv OLLAMA_ORIGINS "https://localhost:3000 https://127.0.0.1:11435 https://localhost:11435"
```

---

## Установка и запуск (dev)

1) Клонируйте репозиторий и поставьте зависимости (если используете любой готовый HTTPS‑сервер):

```bash
git clone <repo>
cd <repo>
npm i -g http-server local-ssl-proxy
```

2) Запустите HTTPS‑сервер для панели (на `3000`)  
   *(используйте свои сертификаты или dev‑сертификаты Office)*:

```bash
http-server . -S -C ./certs/localhost.crt -K ./certs/localhost.key -p 3000
```

3) Проксируйте Ollama в HTTPS (если Ollama слушает на `11434/http`):

```bash
local-ssl-proxy --source 11435 --target 11434 --target-host 127.0.0.1
```

4) Укажите адреса в UI панели:
   - **Ollama host:** `https://127.0.0.1:11435` (или ваш прокси/бэкенд)
   - **Model:** `deepseek-r1:14b` (или другая)

---

## Сайдлоад надстройки в Word

Есть два варианта, выберите любой.

### A) CLI (проще)

```bash
npx office-addin-dev-settings sideload ./manifest.xml desktop --app word
```

### B) Вручную (macOS)

1. Создайте папку, если её нет:  
   `~/Library/Containers/com.microsoft.Word/Data/Documents/wef`
2. Скопируйте туда `manifest.xml`.
3. Перезапустите Word → **Вставка** → **Надстройки** (или **Мои надстройки**) → появится надстройка.

В `manifest.xml` проверьте, что указано:

```xml
<SourceLocation DefaultValue="https://localhost:3000/taskpane.html"/>
```

---

## Использование

1. Откройте Word, вставьте или выделите формальное описание (список фактов).
2. В панели выберите: шаблон, язык, секции, уровень краткости.
3. Нажмите **«Сгенерировать»** — результат появится справа.
4. Нажмите **«Вставить в документ»** — выделение будет заменено готовым текстом.

---

## Конфиденциальность

Надстройка обращается только к локальному Ollama (ваш прокси/узел). Данные документа **не отправляются** во внешние сервисы. Убедитесь, что используемые сертификаты доверены системе.

---

## Типичные проблемы

- **Не грузится / “Load failed”** — запустите панель по HTTPS, проксируйте Ollama на `https://127.0.0.1:11435`, доверьте сертификат.
- **CORS** — добавьте `https://localhost:3000` и адрес прокси в `OLLAMA_ORIGINS`.
- **Висит/падает на больших текстах** — уменьшите объём ввода, используйте 7B‑модель.
